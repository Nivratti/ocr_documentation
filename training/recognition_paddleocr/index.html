
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="OCR Documentation">
      
      
        <meta name="author" content="Nivratti Boyane">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.3">
    
    
      
        <title>Recognition Paddleocr - OCR</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/termynal.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#recognition-paddleocr" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OCR" class="md-header__button md-logo" aria-label="OCR" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OCR
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Recognition Paddleocr
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OCR" class="md-nav__button md-logo" aria-label="OCR" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OCR
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          dataset_preparation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="dataset_preparation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          dataset_preparation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dataset_preparation/annotation-tool/" class="md-nav__link">
        Annotation tool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dataset_preparation/paddleocr_dataset_format/" class="md-nav__link">
        Paddleocr format
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          training
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="training" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          training
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Recognition Paddleocr
      </a>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../structured_data/" class="md-nav__link">
        Structured data
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="recognition-paddleocr">Recognition Paddleocr<a class="headerlink" href="#recognition-paddleocr" title="Permanent link">&para;</a></h1>
<p><a href="https://colab.research.google.com/drive/1mx_IGNlIdaNnlTpde3GJGh-eBdyxgILl?usp=sharing">Colab demo notebook link</a></p>
<p>You can clone demo notebook and check training process. For more details you can refer below doc.</p>
<h1 id="text-recognition-training">Text Recognition training<a class="headerlink" href="#text-recognition-training" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="#DATA_PREPARATION">1. Data Preparation</a></li>
<li><a href="#Custom_Dataset">1.1 Custom Dataset</a></li>
<li><a href="#Dataset_download">1.2 Dataset Download</a></li>
<li><a href="#Dictionary">1.3 Dictionary</a>  </li>
<li><a href="#Add_space_category">1.4 Add Space Category</a></li>
<li><a href="#Data_Augmentation">1.5 Data Augmentation</a></li>
<li><a href="#TRAINING">2. Training</a></li>
<li><a href="#21-start-training">2.1 Start Training</a></li>
<li><a href="#22-load-trained-model-and-continue-training">2.2 Load Trained Model and Continue Training</a></li>
<li><a href="#23-training-with-new-backbone">2.3 Training with New Backbone</a></li>
<li><a href="#24-amp-training">2.4 Mixed Precision Training</a></li>
<li><a href="#25-distributed-training">2.5 Distributed Training</a></li>
<li><a href="#kd">2.6 Training with knowledge distillation</a></li>
<li><a href="#Multi_language">2.7 Multi-language Training</a></li>
<li><a href="#28">2.8 Training on other platform(Windows/macOS/Linux DCU)</a></li>
<li><a href="#3-evaluation-and-test">3. Evaluation and Test</a></li>
<li><a href="#31-evaluation">3.1 Evaluation</a></li>
<li><a href="#32-test">3.2 Test</a></li>
<li><a href="#4-inference">4. Inference</a></li>
<li><a href="#5-faq">5. FAQ</a></li>
</ul>
<p><a name="DATA_PREPARATION"></a></p>
<h2 id="1-data-preparation">1. Data Preparation<a class="headerlink" href="#1-data-preparation" title="Permanent link">&para;</a></h2>
<h3 id="11-dataset-preparation">1.1 DataSet Preparation<a class="headerlink" href="#11-dataset-preparation" title="Permanent link">&para;</a></h3>
<p>To prepare datasets, refer to <a href="https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.6/doc/doc_en/dataset/ocr_datasets_en.md">ocr_datasets</a> .</p>
<p>PaddleOCR provides label files for training the icdar2015 dataset, which can be downloaded in the following ways:</p>
<div class="highlight"><pre><span></span><code># Training set label
wget -P ./train_data/ic15_data  https://paddleocr.bj.bcebos.com/dataset/rec_gt_train.txt
# Test Set Label
wget -P ./train_data/ic15_data  https://paddleocr.bj.bcebos.com/dataset/rec_gt_test.txt
</code></pre></div>
<p>PaddleOCR also provides a data format conversion script, which can convert ICDAR official website label to a data format
supported by PaddleOCR. The data conversion tool is in <code>ppocr/utils/gen_label.py</code>, here is the training set as an example:</p>
<div class="highlight"><pre><span></span><code># convert the official gt to rec_gt_label.txt
python gen_label.py --mode=&quot;rec&quot; --input_path=&quot;{path/of/origin/label}&quot; --output_label=&quot;rec_gt_label.txt&quot;
</code></pre></div>
<p>The data format is as follows, (a) is the original picture, (b) is the Ground Truth text file corresponding to each picture:</p>
<p><img alt="" src="https://raw.githubusercontent.com/PaddlePaddle/PaddleOCR/release/2.6/doc/datasets/icdar_rec.png" /></p>
<ul>
<li>Multilingual dataset</li>
</ul>
<p>The multi-language model training method is the same as the Chinese model. The training data set is 100w synthetic data. A small amount of fonts and test data can be downloaded using the following two methods.
* <a href="https://pan.baidu.com/s/1bS_u207Rm7YbY33wOECKDA">Baidu Netdisk</a> ,Extraction code:frgi.
* <a href="https://drive.google.com/file/d/18cSWX7wXSy4G0tbKJ0d9PuIaiwRLHpjA/view">Google drive</a></p>
<p><a name="Dictionary"></a></p>
<h3 id="12-dictionary">1.2 Dictionary<a class="headerlink" href="#12-dictionary" title="Permanent link">&para;</a></h3>
<p>Finally, a dictionary ({word_dict_name}.txt) needs to be provided so that when the model is trained, all the characters that appear can be mapped to the dictionary index.</p>
<p>Therefore, the dictionary needs to contain all the characters that you want to be recognized correctly. {word_dict_name}.txt needs to be written in the following format and saved in the <code>utf-8</code> encoding format:</p>
<div class="highlight"><pre><span></span><code>l
d
a
d
r
n
</code></pre></div>
<p>In <code>word_dict.txt</code>, there is a single word in each line, which maps characters and numeric indexes together, e.g "and" will be mapped to [2 5 1]</p>
<p>PaddleOCR has built-in dictionaries, which can be used on demand.</p>
<p><code>ppocr/utils/ppocr_keys_v1.txt</code> is a Chinese dictionary with 6623 characters.</p>
<p><code>ppocr/utils/ic15_dict.txt</code> is an English dictionary with 63 characters</p>
<p><code>ppocr/utils/dict/french_dict.txt</code> is a French dictionary with 118 characters</p>
<p><code>ppocr/utils/dict/japan_dict.txt</code> is a Japanese dictionary with 4399 characters</p>
<p><code>ppocr/utils/dict/korean_dict.txt</code> is a Korean dictionary with 3636 characters</p>
<p><code>ppocr/utils/dict/german_dict.txt</code> is a German dictionary with 131 characters</p>
<p><code>ppocr/utils/en_dict.txt</code> is a English dictionary with 96 characters</p>
<p>The current multi-language model is still in the demo stage and will continue to optimize the model and add languages. <strong>You are very welcome to provide us with dictionaries and fonts in other languages</strong>,
If you like, you can submit the dictionary file to <a href="../../ppocr/utils/dict">dict</a> and we will thank you in the Repo.</p>
<p>To customize the dict file, please modify the <code>character_dict_path</code> field in <code>configs/rec/rec_icdar15_train.yml</code> .</p>
<ul>
<li>Custom dictionary</li>
</ul>
<p>If you need to customize dic file, please add character_dict_path field in configs/rec/rec_icdar15_train.yml to point to your dictionary path. And set character_type to ch.</p>
<p><a name="Add_space_category"></a></p>
<h3 id="14-add-space-category">1.4 Add Space Category<a class="headerlink" href="#14-add-space-category" title="Permanent link">&para;</a></h3>
<p>If you want to support the recognition of the <code>space</code> category, please set the <code>use_space_char</code> field in the yml file to <code>True</code>.</p>
<p><a name="Data_Augmentation"></a></p>
<h3 id="15-data-augmentation">1.5 Data Augmentation<a class="headerlink" href="#15-data-augmentation" title="Permanent link">&para;</a></h3>
<p>PaddleOCR provides a variety of data augmentation methods. All the augmentation methods are enabled by default.</p>
<p>The default perturbation methods are: cvtColor, blur, jitter, Gasuss noise, random crop, perspective, color reverse, TIA augmentation.</p>
<p>Each disturbance method is selected with a 40% probability during the training process. For specific code implementation, please refer to: <a href="../../ppocr/data/imaug/rec_img_aug.py">rec_img_aug.py</a></p>
<p><a name="TRAINING"></a></p>
<h2 id="2training">2.Training<a class="headerlink" href="#2training" title="Permanent link">&para;</a></h2>
<p>PaddleOCR provides training scripts, evaluation scripts, and prediction scripts. In this section, the CRNN recognition model will be used as an example:</p>
<p><a name="21-start-training"></a></p>
<h3 id="21-start-training">2.1 Start Training<a class="headerlink" href="#21-start-training" title="Permanent link">&para;</a></h3>
<p>First download the pretrain model, you can download the trained model to finetune on the icdar2015 data:</p>
<div class="highlight"><pre><span></span><code>cd PaddleOCR/
# Download the pre-trained model of en_PP-OCRv3
wget -P ./pretrain_models/ https://paddleocr.bj.bcebos.com/PP-OCRv3/english/en_PP-OCRv3_rec_train.tar
# Decompress model parameters
cd pretrain_models
tar -xf en_PP-OCRv3_rec_train.tar &amp;&amp; rm -rf en_PP-OCRv3_rec_train.tar
</code></pre></div>
<p>Start training:</p>
<div class="highlight"><pre><span></span><code># GPU training Support single card and multi-card training
# Training icdar15 English data and The training log will be automatically saved as train.log under &quot;{save_model_dir}&quot;

#specify the single card training(Long training time, not recommended)
python3 tools/train.py -c configs/rec/PP-OCRv3/en_PP-OCRv3_rec.yml -o Global.pretrained_model=en_PP-OCRv3_rec_train/best_accuracy

#specify the card number through --gpus
python3 -m paddle.distributed.launch --gpus &#39;0,1,2,3&#39;  tools/train.py -c configs/rec/PP-OCRv3/en_PP-OCRv3_rec.yml -o Global.pretrained_model=en_PP-OCRv3_rec_train/best_accuracy
</code></pre></div>
<p>PaddleOCR supports alternating training and evaluation. You can modify <code>eval_batch_step</code> in <code>configs/rec/rec_icdar15_train.yml</code> to set the evaluation frequency. By default, it is evaluated every 500 iter and the best acc model is saved under <code>output/rec_CRNN/best_accuracy</code> during the evaluation process.</p>
<p>If the evaluation set is large, the test will be time-consuming. It is recommended to reduce the number of evaluations, or evaluate after training.</p>
<ul>
<li>Tip: You can use the <code>-c</code> parameter to select multiple model configurations under the <code>configs/rec/</code> path for training. The recognition algorithms supported at <a href="https://github.com/PaddlePaddle/PaddleOCR/blob/dygraph/doc/doc_en/algorithm_overview.md">rec_algorithm</a>:</li>
</ul>
<p>For training Chinese data, it is recommended to use
<a href="../../configs/rec/PP-OCRv3/ch_PP-OCRv3_rec_distillation.yml">ch_PP-OCRv3_rec_distillation.yml</a>. If you want to try the result of other algorithms on the Chinese data set, please refer to the following instructions to modify the configuration file:</p>
<p>Take <code>ch_PP-OCRv3_rec_distillation.yml</code> as an example:
<div class="highlight"><pre><span></span><code>Global:
  ...
  # Add a custom dictionary, such as modify the dictionary, please point the path to the new dictionary
  character_dict_path: ppocr/utils/ppocr_keys_v1.txt
  # Modify character type
  ...
  # Whether to recognize spaces
  use_space_char: True


Optimizer:
  ...
  # Add learning rate decay strategy
  lr:
    name: Cosine
    learning_rate: 0.001
  ...

...

Train:
  dataset:
    # Type of dataset，we support LMDBDataSet and SimpleDataSet
    name: SimpleDataSet
    # Path of dataset
    data_dir: ./train_data/
    # Path of train list
    label_file_list: [&quot;./train_data/train_list.txt&quot;]
    transforms:
      ...
      - RecResizeImg:
          # Modify image_shape to fit long text
          image_shape: [3, 48, 320]
      ...
  loader:
    ...
    # Train batch_size for Single card
    batch_size_per_card: 256
    ...

Eval:
  dataset:
    # Type of dataset，we support LMDBDataSet and SimpleDataSet
    name: SimpleDataSet
    # Path of dataset
    data_dir: ./train_data
    # Path of eval list
    label_file_list: [&quot;./train_data/val_list.txt&quot;]
    transforms:
      ...
      - RecResizeImg:
          # Modify image_shape to fit long text
          image_shape: [3, 48, 320]
      ...
  loader:
    # Eval batch_size for Single card
    batch_size_per_card: 256
    ...
</code></pre></div>
<strong>Note that the configuration file for prediction/evaluation must be consistent with the training.</strong></p>
<p><a name="22-load-trained-model-and-continue-training"></a></p>
<h3 id="22-load-trained-model-and-continue-training">2.2 Load Trained Model and Continue Training<a class="headerlink" href="#22-load-trained-model-and-continue-training" title="Permanent link">&para;</a></h3>
<p>If you expect to load trained model and continue the training again, you can specify the parameter <code>Global.checkpoints</code> as the model path to be loaded.</p>
<p>For example:
<div class="highlight"><pre><span></span><code>python3 tools/train.py -c configs/rec/rec_icdar15_train.yml -o Global.checkpoints<span class="o">=</span>./your/trained/model
</code></pre></div></p>
<p><strong>Note</strong>: The priority of <code>Global.checkpoints</code> is higher than that of <code>Global.pretrained_model</code>, that is, when two parameters are specified at the same time, the model specified by <code>Global.checkpoints</code> will be loaded first. If the model path specified by <code>Global.checkpoints</code> is wrong, the one specified by <code>Global.pretrained_model</code> will be loaded.</p>
<p><a name="23-training-with-new-backbone"></a></p>
<h3 id="23-training-with-new-backbone">2.3 Training with New Backbone<a class="headerlink" href="#23-training-with-new-backbone" title="Permanent link">&para;</a></h3>
<p>The network part completes the construction of the network, and PaddleOCR divides the network into four parts, which are under <a href="../../ppocr/modeling">ppocr/modeling</a>. The data entering the network will pass through these four parts in sequence(transforms-&gt;backbones-&gt;
necks-&gt;heads).</p>
<div class="highlight"><pre><span></span><code>├── architectures <span class="c1"># Code for building network</span>
├── transforms    <span class="c1"># Image Transformation Module</span>
├── backbones     <span class="c1"># Feature extraction module</span>
├── necks         <span class="c1"># Feature enhancement module</span>
└── heads         <span class="c1"># Output module</span>
</code></pre></div>
<p>If the Backbone to be replaced has a corresponding implementation in PaddleOCR, you can directly modify the parameters in the <code>Backbone</code> part of the configuration yml file.</p>
<p>However, if you want to use a new Backbone, an example of replacing the backbones is as follows:</p>
<ol>
<li>Create a new file under the <a href="../../ppocr/modeling/backbones">ppocr/modeling/backbones</a> folder, such as my_backbone.py.</li>
<li>Add code in the my_backbone.py file, the sample code is as follows:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">paddle</span>
<span class="kn">import</span> <span class="nn">paddle.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">paddle.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>


<span class="k">class</span> <span class="nc">MyBackbone</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyBackbone</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># your init code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">xxxx</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="c1"># your network forward</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>
</code></pre></div>
<ol>
<li>Import the added module in the <a href="../../ppocr/modeling/backbones/__init__.py">ppocr/modeling/backbones/_<em>init_</em>.py</a> file.</li>
</ol>
<p>After adding the four-part modules of the network, you only need to configure them in the configuration file to use, such as:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nt">Backbone</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MyBackbone</span><span class="w"></span>
<span class="w">    </span><span class="nt">args1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">args1</span><span class="w"></span>
</code></pre></div>
<p><strong>NOTE</strong>: More details about replace Backbone and other mudule can be found in <a href="add_new_algorithm_en.md">doc</a>.</p>
<p><a name="24-amp-training"></a></p>
<h3 id="24-mixed-precision-training">2.4 Mixed Precision Training<a class="headerlink" href="#24-mixed-precision-training" title="Permanent link">&para;</a></h3>
<p>If you want to speed up your training further, you can use <a href="https://www.paddlepaddle.org.cn/documentation/docs/zh/guides/01_paddle2.0_introduction/basic_concept/amp_cn.html">Auto Mixed Precision Training</a>, taking a single machine and a single gpu as an example, the commands are as follows:</p>
<div class="highlight"><pre><span></span><code>python3 tools/train.py -c configs/rec/rec_icdar15_train.yml <span class="se">\</span>
     -o Global.pretrained_model<span class="o">=</span>./pretrain_models/rec_mv3_none_bilstm_ctc_v2.0_train <span class="se">\</span>
     Global.use_amp<span class="o">=</span>True Global.scale_loss<span class="o">=</span><span class="m">1024</span>.0 Global.use_dynamic_loss_scaling<span class="o">=</span>True
 <span class="sb">```</span>

&lt;a <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;25-distributed-training&quot;</span>&gt;&lt;/a&gt;
<span class="c1">### 2.5 Distributed Training</span>

During multi-machine multi-gpu training, use the <span class="sb">`</span>--ips<span class="sb">`</span> parameter to <span class="nb">set</span> the used machine IP address, and the <span class="sb">`</span>--gpus<span class="sb">`</span> parameter to <span class="nb">set</span> the used GPU ID:

<span class="sb">```</span>bash
python3 -m paddle.distributed.launch --ips<span class="o">=</span><span class="s2">&quot;xx.xx.xx.xx,xx.xx.xx.xx&quot;</span> --gpus <span class="s1">&#39;0,1,2,3&#39;</span> tools/train.py -c configs/rec/rec_icdar15_train.yml <span class="se">\</span>
     -o Global.pretrained_model<span class="o">=</span>./pretrain_models/rec_mv3_none_bilstm_ctc_v2.0_train
</code></pre></div>
<p><strong>Note:</strong> (1) When using multi-machine and multi-gpu training, you need to replace the ips value in the above command with the address of your machine, and the machines need to be able to ping each other. (2) Training needs to be launched separately on multiple machines. The command to view the ip address of the machine is <code>ifconfig</code>. (3) For more details about the distributed training speedup ratio, please refer to <a href="./distributed_training_en.md">Distributed Training Tutorial</a>.</p>
<p><a name="kd"></a></p>
<h3 id="26-training-with-knowledge-distillation">2.6 Training with Knowledge Distillation<a class="headerlink" href="#26-training-with-knowledge-distillation" title="Permanent link">&para;</a></h3>
<p>Knowledge distillation is supported in PaddleOCR for text recognition training process. For more details, please refer to <a href="./knowledge_distillation_en.md">doc</a>.</p>
<p><a name="Multi_language"></a></p>
<h3 id="27-multi-language-training">2.7 Multi-language Training<a class="headerlink" href="#27-multi-language-training" title="Permanent link">&para;</a></h3>
<p>Currently, the multi-language algorithms supported by PaddleOCR are:</p>
<table>
<thead>
<tr>
<th align="center">Configuration file</th>
<th align="center">Algorithm name</th>
<th align="center">backbone</th>
<th align="center">trans</th>
<th align="center">seq</th>
<th align="center">pred</th>
<th align="center">language</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">rec_chinese_cht_lite_train.yml</td>
<td align="center">CRNN</td>
<td align="center">Mobilenet_v3 small 0.5</td>
<td align="center">None</td>
<td align="center">BiLSTM</td>
<td align="center">ctc</td>
<td align="center">chinese traditional</td>
</tr>
<tr>
<td align="center">rec_en_lite_train.yml</td>
<td align="center">CRNN</td>
<td align="center">Mobilenet_v3 small 0.5</td>
<td align="center">None</td>
<td align="center">BiLSTM</td>
<td align="center">ctc</td>
<td align="center">English(Case sensitive)</td>
</tr>
<tr>
<td align="center">rec_french_lite_train.yml</td>
<td align="center">CRNN</td>
<td align="center">Mobilenet_v3 small 0.5</td>
<td align="center">None</td>
<td align="center">BiLSTM</td>
<td align="center">ctc</td>
<td align="center">French</td>
</tr>
<tr>
<td align="center">rec_ger_lite_train.yml</td>
<td align="center">CRNN</td>
<td align="center">Mobilenet_v3 small 0.5</td>
<td align="center">None</td>
<td align="center">BiLSTM</td>
<td align="center">ctc</td>
<td align="center">German</td>
</tr>
<tr>
<td align="center">rec_japan_lite_train.yml</td>
<td align="center">CRNN</td>
<td align="center">Mobilenet_v3 small 0.5</td>
<td align="center">None</td>
<td align="center">BiLSTM</td>
<td align="center">ctc</td>
<td align="center">Japanese</td>
</tr>
<tr>
<td align="center">rec_korean_lite_train.yml</td>
<td align="center">CRNN</td>
<td align="center">Mobilenet_v3 small 0.5</td>
<td align="center">None</td>
<td align="center">BiLSTM</td>
<td align="center">ctc</td>
<td align="center">Korean</td>
</tr>
<tr>
<td align="center">rec_latin_lite_train.yml</td>
<td align="center">CRNN</td>
<td align="center">Mobilenet_v3 small 0.5</td>
<td align="center">None</td>
<td align="center">BiLSTM</td>
<td align="center">ctc</td>
<td align="center">Latin</td>
</tr>
<tr>
<td align="center">rec_arabic_lite_train.yml</td>
<td align="center">CRNN</td>
<td align="center">Mobilenet_v3 small 0.5</td>
<td align="center">None</td>
<td align="center">BiLSTM</td>
<td align="center">ctc</td>
<td align="center">arabic</td>
</tr>
<tr>
<td align="center">rec_cyrillic_lite_train.yml</td>
<td align="center">CRNN</td>
<td align="center">Mobilenet_v3 small 0.5</td>
<td align="center">None</td>
<td align="center">BiLSTM</td>
<td align="center">ctc</td>
<td align="center">cyrillic</td>
</tr>
<tr>
<td align="center">rec_devanagari_lite_train.yml</td>
<td align="center">CRNN</td>
<td align="center">Mobilenet_v3 small 0.5</td>
<td align="center">None</td>
<td align="center">BiLSTM</td>
<td align="center">ctc</td>
<td align="center">devanagari</td>
</tr>
</tbody>
</table>
<p>For more supported languages, please refer to : <a href="https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.1/doc/doc_en/multi_languages_en.md#4-support-languages-and-abbreviations">Multi-language model</a></p>
<p>If you want to finetune on the basis of the existing model effect, please refer to the following instructions to modify the configuration file:</p>
<p>Take <code>rec_french_lite_train</code> as an example:</p>
<div class="highlight"><pre><span></span><code>Global:
  ...
  # Add a custom dictionary, such as modify the dictionary, please point the path to the new dictionary
  character_dict_path: ./ppocr/utils/dict/french_dict.txt
  ...
  # Whether to recognize spaces
  use_space_char: True

...

Train:
  dataset:
    # Type of dataset，we support LMDBDataSet and SimpleDataSet
    name: SimpleDataSet
    # Path of dataset
    data_dir: ./train_data/
    # Path of train list
    label_file_list: [&quot;./train_data/french_train.txt&quot;]
    ...

Eval:
  dataset:
    # Type of dataset，we support LMDBDataSet and SimpleDataSet
    name: SimpleDataSet
    # Path of dataset
    data_dir: ./train_data
    # Path of eval list
    label_file_list: [&quot;./train_data/french_val.txt&quot;]
    ...
</code></pre></div>
<p><a name="28"></a></p>
<h3 id="28-training-on-other-platformwindowsmacoslinux-dcu">2.8 Training on other platform(Windows/macOS/Linux DCU)<a class="headerlink" href="#28-training-on-other-platformwindowsmacoslinux-dcu" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Windows GPU/CPU
The Windows platform is slightly different from the Linux platform:
Windows platform only supports <code>single gpu</code> training and inference, specify GPU for training <code>set CUDA_VISIBLE_DEVICES=0</code>
On the Windows platform, DataLoader only supports single-process mode, so you need to set <code>num_workers</code> to 0;</p>
</li>
<li>
<p>macOS
GPU mode is not supported, you need to set <code>use_gpu</code> to False in the configuration file, and the rest of the training evaluation prediction commands are exactly the same as Linux GPU.</p>
</li>
<li>
<p>Linux DCU
Running on a DCU device requires setting the environment variable <code>export HIP_VISIBLE_DEVICES=0,1,2,3</code>, and the rest of the training and evaluation prediction commands are exactly the same as the Linux GPU.</p>
</li>
</ul>
<p><a name="3-evaluation-and-test"></a></p>
<h2 id="3-evaluation-and-test">3. Evaluation and Test<a class="headerlink" href="#3-evaluation-and-test" title="Permanent link">&para;</a></h2>
<p><a name="31-evaluation"></a></p>
<h3 id="31-evaluation">3.1 Evaluation<a class="headerlink" href="#31-evaluation" title="Permanent link">&para;</a></h3>
<p>The model parameters during training are saved in the <code>Global.save_model_dir</code> directory by default. When evaluating indicators, you need to set <code>Global.checkpoints</code> to point to the saved parameter file. The evaluation dataset can be set by modifying the <code>Eval.dataset.label_file_list</code> field in the <code>configs/rec/PP-OCRv3/en_PP-OCRv3_rec.yml</code> file.</p>
<div class="highlight"><pre><span></span><code># GPU evaluation, Global.checkpoints is the weight to be tested
python3 -m paddle.distributed.launch --gpus &#39;0&#39; tools/eval.py -c configs/rec/PP-OCRv3/en_PP-OCRv3_rec.yml -o Global.checkpoints={path/to/weights}/best_accuracy
</code></pre></div>
<p><a name="32-test"></a></p>
<h3 id="32-test">3.2 Test<a class="headerlink" href="#32-test" title="Permanent link">&para;</a></h3>
<p>Using the model trained by paddleocr, you can quickly get prediction through the following script.</p>
<p>The default prediction picture is stored in <code>infer_img</code>, and the trained weight is specified via <code>-o Global.checkpoints</code>:</p>
<p>According to the <code>save_model_dir</code> and <code>save_epoch_step</code> fields set in the configuration file, the following parameters will be saved:</p>
<div class="highlight"><pre><span></span><code>output/rec/
├── best_accuracy.pdopt  
├── best_accuracy.pdparams  
├── best_accuracy.states  
├── config.yml  
├── iter_epoch_3.pdopt  
├── iter_epoch_3.pdparams  
├── iter_epoch_3.states  
├── latest.pdopt  
├── latest.pdparams  
├── latest.states  
└── train.log
</code></pre></div>
<p>Among them, best_accuracy.<em> is the best model on the evaluation set; iter_epoch_x.</em> is the model saved at intervals of <code>save_epoch_step</code>; latest.* is the model of the last epoch.</p>
<div class="highlight"><pre><span></span><code># Predict English results
python3 tools/infer_rec.py -c configs/rec/PP-OCRv3/en_PP-OCRv3_rec.yml -o Global.pretrained_model={path/to/weights}/best_accuracy  Global.infer_img=doc/imgs_words/en/word_1.png
</code></pre></div>
<p>Input image:</p>
<p><img alt="" src="https://raw.githubusercontent.com/PaddlePaddle/PaddleOCR/release/2.6/doc/imgs_words/en/word_1.png" /></p>
<p>Get the prediction result of the input image:</p>
<div class="highlight"><pre><span></span><code>infer_img: doc/imgs_words/en/word_1.png
        result: (&#39;joint&#39;, 0.9998967)
</code></pre></div>
<p>The configuration file used for prediction must be consistent with the training. For example, you completed the training of the Chinese model with <code>python3 tools/train.py -c configs/rec/ch_ppocr_v2.0/rec_chinese_lite_train_v2.0.yml</code>, you can use the following command to predict the Chinese model:</p>
<div class="highlight"><pre><span></span><code># Predict Chinese results
python3 tools/infer_rec.py -c configs/rec/ch_ppocr_v2.0/rec_chinese_lite_train_v2.0.yml -o Global.pretrained_model={path/to/weights}/best_accuracy Global.infer_img=doc/imgs_words/ch/word_1.jpg
</code></pre></div>
<p>Input image:</p>
<p><img alt="" src="https://raw.githubusercontent.com/PaddlePaddle/PaddleOCR/release/2.6/doc/imgs_words/ch/word_1.jpg" /></p>
<p>Get the prediction result of the input image:</p>
<div class="highlight"><pre><span></span><code>infer_img: doc/imgs_words/ch/word_1.jpg
        result: (&#39;韩国小馆&#39;, 0.997218)
</code></pre></div>
<p><a name="4-inference"></a></p>
<h2 id="4-inference">4. Inference<a class="headerlink" href="#4-inference" title="Permanent link">&para;</a></h2>
<p>The inference model (the model saved by <code>paddle.jit.save</code>) is generally a solidified model saved after the model training is completed, and is mostly used to give prediction in deployment.</p>
<p>The model saved during the training process is the checkpoints model, which saves the parameters of the model and is mostly used to resume training.</p>
<p>Compared with the checkpoints model, the inference model will additionally save the structural information of the model. Therefore, it is easier to deploy because the model structure and model parameters are already solidified in the inference model file, and is suitable for integration with actual systems.</p>
<p>The recognition model is converted to the inference model in the same way as the detection, as follows:</p>
<div class="highlight"><pre><span></span><code># -c Set the training algorithm yml configuration file
# -o Set optional parameters
# Global.pretrained_model parameter Set the training model address to be converted without adding the file suffix .pdmodel, .pdopt or .pdparams.
# Global.save_inference_dir Set the address where the converted model will be saved.

python3 tools/export_model.py -c configs/rec/PP-OCRv3/en_PP-OCRv3_rec.yml -o Global.pretrained_model=en_PP-OCRv3_rec_train/best_accuracy  Global.save_inference_dir=./inference/en_PP-OCRv3_rec/
</code></pre></div>
<p>If you have a model trained on your own dataset with a different dictionary file, please make sure that you modify the <code>character_dict_path</code> in the configuration file to your dictionary file path.</p>
<p>After the conversion is successful, there are three files in the model save directory:</p>
<div class="highlight"><pre><span></span><code>inference/en_PP-OCRv3_rec/
    ├── inference.pdiparams         # The parameter file of recognition inference model
    ├── inference.pdiparams.info    # The parameter information of recognition inference model, which can be ignored
    └── inference.pdmodel           # The program file of recognition model
</code></pre></div>
<ul>
<li>Text recognition model Inference using custom characters dictionary</li>
</ul>
<p>If the text dictionary is modified during training, when using the inference model to predict, you need to specify the dictionary path used by <code>--rec_char_dict_path</code></p>
<div class="highlight"><pre><span></span><code>python3 tools/infer/predict_rec.py --image_dir=&quot;./doc/imgs_words_en/word_336.png&quot; --rec_model_dir=&quot;./your inference model&quot; --rec_image_shape=&quot;3, 32, 100&quot; --rec_char_dict_path=&quot;your text dict path&quot;
</code></pre></div>
<p><a name="5-faq"></a></p>
<h2 id="5-faq">5. FAQ<a class="headerlink" href="#5-faq" title="Permanent link">&para;</a></h2>
<p>Q1: After the training model is transferred to the inference model, the prediction effect is inconsistent?</p>
<p><strong>A</strong>: There are many such problems, and the problems are mostly caused by inconsistent preprocessing and postprocessing parameters when the trained model predicts and the preprocessing and postprocessing parameters when the inference model predicts. You can compare whether there are differences in preprocessing, postprocessing, and prediction in the configuration files used for training.</p>
<h2 id="6-reference">6. Reference:<a class="headerlink" href="#6-reference" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><a href="https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.6/doc/doc_en/recognition_en.md">recognition_en.md</a></p>
</li>
<li>
<p><a href="https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.6/doc/doc_en/training_en.md">training_en.md</a></p>
</li>
</ol>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../../dataset_preparation/paddleocr_dataset_format/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Paddleocr format" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Paddleocr format
            </div>
          </div>
        </a>
      
      
        
        <a href="../../structured_data/" class="md-footer__link md-footer__link--next" aria-label="Next: Structured data" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Structured data
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.37e9125f.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.4.6/dist/mermaid.min.js"></script>
      
        <script src="../../js/termynal.js"></script>
      
        <script src="../../js/custom.js"></script>
      
    
  </body>
</html>